/*! Lazy Load 1.9.3 - MIT license - Copyright 2010-2013 Mika Tuupola */
!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(f){function g(){var b=0;i.each(function(){var c=a(this);if(!j.skip_invisible||c.is(":visible"))if(a.abovethetop(this,j)||a.leftofbegin(this,j));else if(a.belowthefold(this,j)||a.rightoffold(this,j)){if(++b>j.failure_limit)return!1}else c.trigger("appear"),b=0})}var h,i=this,j={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return f&&(d!==f.failurelimit&&(f.failure_limit=f.failurelimit,delete f.failurelimit),d!==f.effectspeed&&(f.effect_speed=f.effectspeed,delete f.effectspeed),a.extend(j,f)),h=j.container===d||j.container===b?e:a(j.container),0===j.event.indexOf("scroll")&&h.bind(j.event,function(){return g()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,(c.attr("src")===d||c.attr("src")===!1)&&c.is("img")&&c.attr("src",j.placeholder),c.one("appear",function(){if(!this.loaded){if(j.appear){var d=i.length;j.appear.call(b,d,j)}a("<img />").bind("load",function(){var d=c.attr("data-"+j.data_attribute);c.hide(),c.is("img")?c.attr("src",d):c.css("background-image","url('"+d+"')"),c[j.effect](j.effect_speed),b.loaded=!0;var e=a.grep(i,function(a){return!a.loaded});if(i=a(e),j.load){var f=i.length;j.load.call(b,f,j)}}).attr("src",c.attr("data-"+j.data_attribute))}}),0!==j.event.indexOf("scroll")&&c.bind(j.event,function(){b.loaded||c.trigger("appear")})}),e.bind("resize",function(){g()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&e.bind("pageshow",function(b){b.originalEvent&&b.originalEvent.persisted&&i.each(function(){a(this).trigger("appear")})}),a(c).ready(function(){g()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?(b.innerHeight?b.innerHeight:e.height())+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e.scrollLeft():a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollLeft():a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.expr[":"],{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}(jQuery,window,document);

//ie 9 placeholder
$(document).ready(function(){
    ie9Placeholder();
})
function ie9Placeholder(){
    if(!('placeholder' in document.createElement('input'))) {
        // 将返回的nodeList对象转为数组
        //var nodes = Array.prototype.slice.call(document.querySelectorAll('[placeholder]'))
        //alert($('.placeholder').length)
        var nodes = Array.prototype.slice.call($('.placeholder'))
        nodes.forEach(function (item, index) {
            item.addEventListener('focus', function () {
                this.nextSibling.style.display = 'none'
            })
            item.addEventListener('blur', function () {
                if (!this.value) {
                    this.style.display = 'none'
                    this.nextSibling.style.display = 'inline'
                }
            })
            var cloneNode = item.cloneNode()
            // 如果[type='password']类型，则转为text
            if (cloneNode.getAttribute('type').toLowerCase() === 'password') {
                cloneNode.setAttribute('type', 'text')
            }
            cloneNode.setAttribute('value', cloneNode.getAttribute('placeholder'))
            cloneNode.style.display = 'none'
            item.insertAdjacentHTML('afterend', cloneNode.outerHTML)
            item.nextSibling.addEventListener('focus', function () {
                this.style.display = 'none'
                this.previousSibling.style.display = 'inline'
                this.previousSibling.focus()
            })
            if (!item.value) {
                item.style.display = 'none'
                item.nextSibling.style.display = 'inline'
            }
        })
    }
}



/**
 * @Title:
 * @Author: pf
 * @Despricetion:TODO 公共反馈方法封装
 * @Date: 2018/10/29 18:54
 * @Param:
 * @Return:
 */
function feedBackFn(type){
    var feedHtml='';
    feedHtml+='<div class="feed_back" id="feedBack" style="font-size:14px;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:9998" >';
    feedHtml+='<div class="feed_close" onclick="feedBackClose()" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:9999"></div>';
    feedHtml+='<div class="problbox1" style="position:absolute;left:0;top:0;right:0;bottom:0;margin:auto;width:375px;height:370px;padding:20px;background:#fff;border-radius:8px;z-index:10000;box-sizing: initial">';
    feedHtml+='<span class="probclose" onclick="feedBackClose()" style="position:absolute;top:0;right:0;padding:8px;color:red;cursor:pointer">X</span>';
    feedHtml+='<p class="probforp" style="margin:10px 0;position:relative">';
    feedHtml+='<label class="probfolab" style="display:inline-block;width:80px;text-align:left"><span style="color:red">*</span>Email:</label>';
    feedHtml+='<input id="form_email" type="text" class="probfinp" value="" onblur="fnProblemFeedBack();" style="display:inline-block;width:280px;height:28px;line-height:24px;border:1px solid #bfbdbd;border-radius:5px;text-indent:5px;outline:none;resize:none" />';
    feedHtml+='</p>';
    feedHtml+='<p class="modal_warning" style="height:20px;color:red;margin-left:85px;margin-top:-6px;font-size:13px"><span id="modal_warning" style="color:red"></span></p>';
    feedHtml+='<p class="probforp" style="margin:10px 0;position:relative">';
    feedHtml+='<label class="probfolab" style="display:inline-block;width:80px;text-align:left"><span style="color:red">*</span>Problem:</label>';
    feedHtml+='<textarea id="form_problem" onblur="fnProblemFeedBackArea()" class="probfotear" placeholder="Describe your problem or suggestions." style="display:inline-block;width:270px;height:140px;border:1px solid #bfbdbd;border-radius:5px;padding:5px;font-size:13px;vertical-align:text-top;color:#777;outline:none;resize:none"></textarea>';
    feedHtml+='</p>';
    feedHtml+='<p class="modal_warning" style="height:20px;color:red;margin-left:85px;margin-top:-6px;font-size:13px"><span id="modal_warning_area" style="color:red"></span></p>';
    feedHtml+='<div class="probforp" style="margin:10px 0;position:relative;text-align:center">';
    feedHtml+='<button onclick="fnProblemFeedBackBtn('+type+');" class="probfbtn" style="display:inline-block;width:90px;height:36px;font-size:15px;text-align:center;cursor:pointer;color:#fff;background:#00afff;border-radius:5px;border:0">Submit</button>';
    feedHtml+='<p id="modal_warning_submit" style="display:none;color:red;font-size:13px;margin-top:5px;">* Submission failed</p>';
    feedHtml+='</div>';
    feedHtml+='<p class="probforp" style="margin:10px 0;position:relative;border-top:1px solid #bfbdbd;padding-top:10px;width:375px;font-size:13px;color:#777">';
    feedHtml+='<span>You can also click </span>';
    feedHtml+='<a href="../apa/contact.html" style="color:#00afff">here</a>';
    feedHtml+='<span> to contact us, we will help you solve the problem as soon as possible.</span>';
    feedHtml+='</p>';
    feedHtml+='</div>';
    feedHtml+='<div class="proBackShow" style="display:none;background:#fff;border:2px solid #00afff;border-radius:5px;padding:20px;position:absolute;left:0;top:0;right:0;bottom:0;margin:auto;width:200px;height:34px;z-index:1001">';
    /*feedHtml+='<span class="proBackClose" onclick="fnProblemClose()" style="position:absolute;right:3px;top:2px;color:#4d8fe0;cursor:pointer">X</span>';*/
    feedHtml+='<img  src="/img/yes_.png" style="float:left;" class="img_suc_dd" />';
    feedHtml+='<span style="line-height:32px;float:left;padding-left:5px;color:limegreen">Submitted successfully</span>';
    feedHtml+='</div>';
    feedHtml+='</div>';
    $('body').append(feedHtml);
    var userEmail=decodeURIComponent(getCookie('userInfo'));
    if($.trim(userEmail)){
        var arrInfo=$.trim(userEmail).split('=');
        if(arrInfo[0]){
            if(arrInfo[0].indexOf('@')>-1){
                $('#form_email').val(arrInfo[0]);
            }
        }
        if(arrInfo[1]){
            if(arrInfo[1].indexOf('@')>-1) {
                $('#form_email').val(arrInfo[1]);
            }
        }
        if(arrInfo[2]){
            if(arrInfo[2].indexOf('@')>-1) {
                $('#form_email').val(arrInfo[2]);
            }
        }
    }

}

function feedBackClose(){
    $('#feedBack').remove();
}

function fnProblemFeedBackBtn(type){
    var emailFlag = fnProblemFeedBack();
    var proFlag = fnProblemFeedBackArea();
    var email = $.trim($("#form_email").val());
    var problem = $.trim($("#form_problem").val());
    if(emailFlag&&proFlag){
        $.ajax({
            type : "post",
            url : "/retroaction/problem",
            datatype : "json",
            data : {
                "email":email,
                "problem":problem,
                "type":type
            },
            success : function(data){
                if(data){
                    $("#modal_warning_submit").hide();
                    $('.problbox1').hide();
                    $(".proBackShow").show();
                    setTimeout(function(){
                        $('#feedBack').remove();
                    }, 1500);
                }else{
                    $("#modal_warning_submit").show();
                }
            },
            error : function(data){
                console.log(data);
            }
        });
    }
}

function fnProblemFeedBack(){
    var emailFlag = false;
    var email = $.trim($("#form_email").val());
    if(email==null||email==""){
        $("#modal_warning").html("* Enter a valid email");
        $("#modal_warning").show();
        emailFlag = false;
        return emailFlag;
    }else{
        var re =  /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
        if(re.test(email)){
            emailFlag = true;
            $("#modal_warning").html("");
            $("#modal_warning").hide();
        }else{
            $("#modal_warning").html("* Enter a valid email");
            $("#modal_warning").show();
            emailFlag = false;
            return emailFlag;
        }
    }
    return emailFlag;
}
function fnProblemFeedBackArea(){
    var proFlag = false;
    var problem = $.trim($("#form_problem").val());
    if(problem==null||problem==""){
        $("#modal_warning_area").html("* Enter your problem or suggestions");
        $("#modal_warning_area").show();
        proFlag = false;
        return proFlag;
    }else{
        $("#modal_warning_area").html("");
        $("#modal_warning_area").hide();
        proFlag = true;
    }
    return proFlag;
}


/*读取cookie*/
function getCookie(cookieName){
    var cookieStr=document.cookie;
    if(cookieStr==null ||cookieStr== undefined){
        return '';
    }
    var cookievalue="";
    var arrayCookie=cookieStr.split(';');
    for(var i=0;i<arrayCookie.length;i++){
        var arrayDetail=arrayCookie[i].split('=');
        if(arrayDetail[0].indexOf(cookieName)>-1){
            cookievalue = arrayDetail[1];
            break;
        }
    }
    return cookievalue;
}